package uk.gov.justice.digital.sonar.plugin.containercheck.rule;

import static uk.gov.justice.digital.sonar.plugin.containercheck.base.ContainerCheckConstants.LANGUAGE_KEY;
import static uk.gov.justice.digital.sonar.plugin.containercheck.base.ContainerCheckConstants.REPOSITORY_KEY;
import static uk.gov.justice.digital.sonar.plugin.containercheck.base.ContainerCheckConstants.RULE_KEY;

import org.sonar.api.rule.Severity;
import org.sonar.api.server.rule.RulesDefinition;

public class KnownVulnerabilityRuleDefinition implements RulesDefinition {

	@Override
    public void define(final Context context) {
        final NewRepository repo = context.createRepository(REPOSITORY_KEY, LANGUAGE_KEY);
        repo.setName("Trivy Output Analyzer");

        final NewRule rule = repo.createRule(RULE_KEY);
        rule.addTags("vulnerability");
        rule.setName("Using packages in docker containers with Known Vulnerabilities (NVD)");
        rule.setSeverity(Severity.MAJOR);

        final String description = "<p>Packages installed as part of a docker image may have vulnerabilities.</p>" +
                "<h3>References:</h3>" +
                "<ul><li>OWASP Top 10 2013-A9: <a href=\"https://www.owasp.org/index.php/Top_10_2013-A9-Using_Components_with_Known_Vulnerabilities\">Using Components with Known Vulnerabilities</a></li>" +
                "<li><a href=\"https://cwe.mitre.org/data/definitions/937.html\">Common Weakness Enumeration CWE-937</a></li>" +
                "<p>This issue was generated by Trivy</a>";
        rule.setHtmlDescription(description);

        repo.done();
    }

}
